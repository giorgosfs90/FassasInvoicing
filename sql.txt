CREATE TABLE ETERIES(
AFM VARCHAR(9)  NOT NULL PRIMARY KEY check (LEN(AFM)=9),
EPONIMIA varchar(50) NOT NULL,
DRASTIRIOTITA varchar(100) NOT NULL,
DOY varchar(30) NOT NULL,
DIEFTHINSI varchar(100) NOT NULL,
POLI varchar(30) NOT NULL,
TK varchar(5) NOT NULL check (LEN(TK) =5),
XORA varchar(30) NOT NULL,
TILEFONO varchar(10) NOT NULL,
EMAIL varchar(50) NOT NULL,
);

CREATE TABLE POSOSTA_FPA (
ID_POSOSTO_FPA int NOT NULL PRIMARY KEY,
FPA decimal(5,2) NOT NULL
);

CREATE TABLE TROPOI_PLIROMIS(
ID_TROP_PLIR int NOT NULL PRIMARY KEY,
PLIROMI varchar(10) NOT NULL
);

CREATE TABLE INV_ITEMS(
ITEM_ID INT NOT NULL PRIMARY KEY,
INVOICE_ID INT NOT NULL FOREIGN KEY REFERENCES TIMOLOGIA(AA),
PERIGRAFI varchar(255) not null,
POSO DECIMAL(13, 2) NOT NULL
);

CREATE TABLE TIMOLOGIA (
AA int NOT NULL PRIMARY KEY,
AFM varchar(9) FOREIGN KEY REFERENCES Eteries(AFM) NOT NULL,
HMEROMINIA date NOT NULL,
AKSIA DECIMAL(13, 2) NOT NULL,
POSOSTO_FPA int FOREIGN KEY REFERENCES POSOSTA_FPA(ID_POSOSTO_FPA) NOT NULL,
FPA DECIMAL(13, 2) NOT NULL,
FOROS20 DECIMAL(13,2),
PLIROTEO DECIMAL(13, 2) NOT NULL,
TROPOS_PLIROMIS int FOREIGN KEY REFERENCES TROPOI_PLIROMIS(ID_TROP_PLIR) NOT NULL,
);	

CREATE TABLE PLIROMES (
ID_PLIROMIS INT NOT NULL,
AFM varchar(9) FOREIGN KEY REFERENCES Eteries(AFM) NOT NULL,
TROPOS_PLIROMIS INT FOREIGN KEY REFERENCES TROPOI_PLIROMIS(ID_TROP_PLIR) NOT NULL,
AR_PLIR VARCHAR(20) NOT NULL,
HMEROMINIA date NOT NULL,
PERIGRAFI varchar(50)
POSO DECIMAL(13, 2) NOT NULL
);

---καρτελα πελατη-----(HMEROMHNIA, AR.TIMOLOGIOU,TROPOS PLIROMIS, POSO)

SELECT (TIMOLOGIA.HMEROMINIA+PLIROMES.HMEROMINIA) AS HMEROMINIA,(TIMOLOGIA.AA+PLIROMES.AR_PLIR)AS ARITHM_PARAST,
(ITEMS.PERIGRAFI+PLIROMES.PERIGRAFI) AS PERIGRAFI,PLIROMES.TROPOS_PLIROMIS,(TIMOLOGIA.PLIROTEO+PLIROMES.POSO) AS POSO
FROM ETERIES, TROPOI_PLIROMIS, INV_ITEMS, TIMOLOGIA, PLIROMES
WHERE AFM="095118884", ETERIES.AFM=TIMOLOGIA.AFM,TIMOLOGIA.AA=INV_ITEMS.I



	





	
	STORED PROCEDDURES
	---------------------------------------------------------
	
-- =============================================
-- Author:		<GF>
-- Create date: <22/03/2021>
-- Description:	<Insert into eteries>
-- =============================================
CREATE PROCEDURE dbo.spETERIES_INSERT
	@AFM bigint,
	@EPONIMIA varchar(50),
	@DRASTIRIOTITA varchar(100),
	@DOY varchar(30),
	@DIEFTHINSI varchar(100),
	@POLI varchar(30),
	@TK int,
	@XORA varchar(30),
	@TILEFONO varchar(10),
	@EMAIL varchar(50)

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	insert into dbo.ETERIES(AFM,EPONIMIA,DRASTIRIOTITA,DOY,DIEFTHINSI,POLI,TK,XORA,TILEFONO,EMAIL)
	values (@AFM,@EPONIMIA,@DRASTIRIOTITA,@DOY,@DIEFTHINSI,@POLI,@TK,@XORA,@TILEFONO,@EMAIL)
END
GO